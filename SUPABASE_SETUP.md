# Supabase Setup Guide

This guide will help you connect your API Organizer dashboard to a Supabase database.

## üöÄ **Step 1: Create a Supabase Project**

1. Go to [supabase.com](https://supabase.com) and sign in
2. Click "New Project"
3. Choose your organization
4. Enter project details:
   - **Name**: `api-organizer` (or your preferred name)
   - **Database Password**: Choose a strong password
   - **Region**: Select the region closest to your users
5. Click "Create new project"

## üîë **Step 2: Get Your Project Credentials**

1. In your project dashboard, go to **Settings** ‚Üí **API**
2. Copy the following values:
   - **Project URL**: `https://your-project-id.supabase.co`
   - **Anon/Public Key**: The `anon` key (starts with `eyJ...`)

## üìù **Step 3: Update Environment Variables**

1. In your project root, edit the `.env.local` file:
   ```bash
   # Supabase Configuration
   NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
   NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key_here
   ```

2. Replace the placeholder values with your actual Supabase credentials

## üóÑÔ∏è **Step 4: Create Database Table**

**Option A: Use the Simple Schema (Recommended for beginners)**
1. In your Supabase dashboard, go to **SQL Editor**
2. Copy and paste the contents of `supabase-simple-schema.sql`
3. Click "Run" to execute the SQL

**Option B: Use the Advanced Schema**
1. In your Supabase dashboard, go to **SQL Editor**
2. Copy and paste the contents of `supabase-schema.sql`
3. Click "Run" to execute the SQL

**What gets created:**
- `api_keys` table with proper structure
- Indexes for performance
- Row Level Security (RLS) policies
- Sample data

## ‚ö†Ô∏è **Common Supabase Type Issues & Solutions**

### **Issue 1: "TIMESTAMP WITH TIME ZONE" not found**
**Solution**: Use `TIMESTAMPTZ` instead:
```sql
-- ‚ùå This might not work in some Supabase versions
created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()

-- ‚úÖ Use this instead
created_at TIMESTAMPTZ DEFAULT NOW()
```

### **Issue 2: "SERIAL" not supported**
**Solution**: Use `INTEGER GENERATED BY DEFAULT AS IDENTITY` instead:
```sql
-- ‚ùå This might cause issues
id SERIAL PRIMARY KEY

-- ‚úÖ Use this instead
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY
```

### **Issue 3: "BIGINT" not supported**
**Solution**: Use `INTEGER` instead:
```sql
-- ‚ùå This might cause issues
usage BIGINT DEFAULT 0

-- ‚úÖ Use this instead
usage INTEGER DEFAULT 0
```

### **Issue 4: RLS Policy with auth.role() fails**
**Solution**: Use a simple policy for development:
```sql
-- ‚ùå This might fail if auth is not set up
CREATE POLICY "Allow all operations for authenticated users" ON api_keys
  FOR ALL USING (auth.role() = 'authenticated');

-- ‚úÖ Use this for development
CREATE POLICY "Allow all operations" ON api_keys
  FOR ALL USING (true);
```

## üîí **Step 5: Configure Row Level Security (Optional)**

The default policy allows all operations. You can customize this:

1. Go to **Authentication** ‚Üí **Policies**
2. Find the `api_keys` table
3. Modify the policy based on your needs:
   ```sql
   -- Example: Only allow users to see their own API keys
   CREATE POLICY "Users can only see their own API keys" ON api_keys
     FOR ALL USING (auth.uid()::text = user_id);
   ```

## üß™ **Step 6: Test the Connection**

1. Start your development server:
   ```bash
   npm run dev
   ```

2. Navigate to `/dashboards`
3. Try creating, editing, and deleting API keys
4. Check the browser console for any errors

## üìä **Database Schema**

The `api_keys` table has the following structure:

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER GENERATED BY DEFAULT AS IDENTITY | Primary key, auto-incrementing |
| `name` | VARCHAR(255) | API key name (required) |
| `description` | TEXT | Optional description |
| `key` | VARCHAR(255) | The actual API key (unique) |
| `type` | VARCHAR(50) | Key type: 'dev', 'live', or 'test' |
| `usage` | INTEGER | Usage count (default: 0) |
| `permissions` | TEXT[] | Array of permissions |
| `created_at` | TIMESTAMP | When the key was created |
| `updated_at` | TIMESTAMP | When the key was last updated |
| `last_used` | TIMESTAMP | When the key was last used |

## üö® **Troubleshooting**

### **Common Issues:**

1. **"Missing Supabase environment variables"**
   - Check that `.env.local` exists and has correct values
   - Restart your development server after changing environment variables

2. **"Failed to fetch API keys"**
   - Verify your Supabase URL and key are correct
   - Check that the `api_keys` table exists
   - Ensure RLS policies allow your operations

3. **"Permission denied"**
   - Check your RLS policies in Supabase
   - Verify you're using the correct API key

4. **Database connection errors**
   - Check your internet connection
   - Verify your Supabase project is active
   - Check the Supabase status page

5. **SQL type errors**
   - Use the `supabase-simple-schema.sql` file instead
   - Check the "Common Supabase Type Issues" section above
   - Ensure you're using the latest Supabase version

### **Debug Steps:**

1. Open browser console (F12)
2. Look for error messages
3. Check Network tab for failed requests
4. Verify environment variables are loaded:
   ```javascript
   console.log('SUPABASE_URL:', process.env.NEXT_PUBLIC_SUPABASE_URL)
   ```

5. Test database connection in Supabase:
   - Go to **SQL Editor**
   - Run: `SELECT * FROM api_keys;`
   - Should return your sample data

## üîê **Security Considerations**

1. **Never commit `.env.local` to version control**
2. **Use environment variables for all sensitive data**
3. **Implement proper authentication before production**
4. **Consider using Supabase Auth for user management**
5. **Regularly rotate API keys**

## üìö **Additional Resources**

- [Supabase Documentation](https://supabase.com/docs)
- [Supabase JavaScript Client](https://supabase.com/docs/reference/javascript)
- [Row Level Security Guide](https://supabase.com/docs/guides/auth/row-level-security)
- [Supabase Data Types](https://supabase.com/docs/reference/javascript/types)

## üéØ **Next Steps**

After successful setup, consider:

1. **Adding user authentication** with Supabase Auth
2. **Implementing real-time updates** with Supabase subscriptions
3. **Adding usage tracking** and analytics
4. **Setting up automated backups**
5. **Implementing rate limiting**

---

**Need help?** Check the Supabase community forum or create an issue in this repository.
